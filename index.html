
<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o de Materiais</title>
    <style>
        /* Estilos principais do sistema */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }

        body {
            background-color: #282828;
            color: #ffffff;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar esquerda */
        .sidebar {
            width: 300px;
            background-color: #222222;
            padding: 20px;
            border-right: 2px solid #424242;
        }

        .sidebar h2 {
            color: #35568C;
            margin-bottom: 20px;
            border-bottom: 2px solid #35568C;
            padding-bottom: 10px;
        }

        .nav-item {
            padding: 15px;
            margin: 10px 0;
            background-color: #323232;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .nav-item:hover {
            background-color: #424242;
            border-color: #35568C;
        }

        .nav-item.active {
            background-color: #35568C;
            border-color: #89A9D2;
        }

        /* √Årea principal */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Filtros de pesquisa */
        .filters-container {
            background-color: #323232;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #424242;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            color: #B5B5B5;
            font-weight: bold;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #424242;
            border-radius: 5px;
            background-color: #282828;
            color: #ffffff;
            font-size: 14px;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #35568C;
        }

        /* Checkboxes para certifica√ß√µes */
        .certifications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .cert-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background-color: #282828;
            border-radius: 5px;
            border: 1px solid #424242;
        }

        .cert-checkbox input[type="checkbox"] {
            width: auto;
        }

        /* Lista de materiais */
        .materials-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .material-card {
            background-color: #323232;
            border: 2px solid #424242;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .material-card:hover {
            border-color: #35568C;
            transform: translateY(-2px);
        }

        .material-card.not-in-db {
            background-color: #8C3535;
            border-color: #c21b12;
        }

        .material-info {
            margin-bottom: 10px;
        }

        .material-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #35568C;
            margin-bottom: 10px;
        }

        .material-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .material-detail {
            color: #B5B5B5;
        }

        .material-detail strong {
            color: #ffffff;
        }

        /* Avalia√ß√µes coloridas */
        .evaluations {
            margin: 15px 0;
        }

        .evaluation-tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            border-radius: 3px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .eval-green { color: #358C48; }
        .eval-red { color: #8C3535; }
        .eval-blue { color: #35568C; }

        /* Bot√µes de a√ß√£o */
        .action-buttons {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 5px;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: #35568C;
            color: white;
        }

        .btn-primary:hover {
            background-color: #89A9D2;
        }

        .btn-success {
            background-color: #358C48;
            color: white;
        }

        .btn-success:hover {
            background-color: #4ea045;
        }

        .btn-danger {
            background-color: #8C3535;
            color: white;
        }

        .btn-danger:hover {
            background-color: #a04545;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background-color: #323232;
            margin: 5% auto;
            padding: 20px;
            border: 2px solid #35568C;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            color: #ffffff;
        }

        .close {
            color: #B5B5B5;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #ffffff;
        }

        /* Formul√°rios */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #B5B5B5;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #424242;
            border-radius: 5px;
            background-color: #282828;
            color: #ffffff;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Avalia√ß√µes detalhadas */
        .evaluation-section {
            background-color: #282828;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid #424242;
        }

        .evaluation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .evaluation-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #35568C;
        }

        .evaluation-score {
            font-size: 1.1em;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: #424242;
        }

        .evaluation-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .field-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background-color: #323232;
            border-radius: 5px;
        }

        .field-group input[type="checkbox"] {
            width: auto;
        }

        .field-group input[type="text"],
        .field-group input[type="date"],
        .field-group select {
            flex: 1;
        }

        /* Responsivo */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .filter-row {
                flex-direction: column;
            }
            
            .material-details {
                grid-template-columns: 1fr;
            }
        }

        /* Utilit√°rios */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Sidebar de navega√ß√£o -->
    <div class="sidebar">
        <h2>Sistema de Materiais</h2>
        <div class="nav-item active" onclick="showPage('search')">
            üîç Pesquisar Materiais
        </div>
        <div class="nav-item" onclick="showPage('database')">
            üóÑÔ∏è Base de Dados
        </div>
        <div class="nav-item" onclick="showPage('projects')">
            üìä Projetos
        </div>
    </div>

    <!-- Conte√∫do principal -->
    <div class="main-content">
        <!-- P√°gina de pesquisa de materiais -->
        <div id="search" class="page active">
            <h1>Pesquisa de Materiais</h1>
            
            <!-- Filtros de pesquisa -->
            <div class="filters-container">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="searchInput">Pesquisar Materiais:</label>
                        <input type="text" id="searchInput" placeholder="Nome do material..." oninput="filterMaterials()">
                    </div>
                    <div class="filter-group">
                        <label for="manufacturerFilter">Fabricante:</label>
                        <select id="manufacturerFilter" onchange="filterMaterials()">
                            <option value="">Todos os fabricantes</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="categoryFilter">Categoria:</label>
                        <select id="categoryFilter" onchange="updateSubcategories(); filterMaterials()">
                            <option value="">Todas as categorias</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="subcategoryFilter">Subcategoria:</label>
                        <select id="subcategoryFilter" onchange="filterMaterials()">
                            <option value="">Todas as subcategorias</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>Certifica√ß√µes:</label>
                    <div class="certifications-grid">
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-epd" onchange="filterMaterials()">
                            <label for="cert-epd">EPD</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-lca" onchange="filterMaterials()">
                            <label for="cert-lca">LCA</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-mi" onchange="filterMaterials()">
                            <label for="cert-mi">Manufacturer Inventory</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-reach" onchange="filterMaterials()">
                            <label for="cert-reach">REACH</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-hpd" onchange="filterMaterials()">
                            <label for="cert-hpd">HPD</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-c2c" onchange="filterMaterials()">
                            <label for="cert-c2c">C2C</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-declare" onchange="filterMaterials()">
                            <label for="cert-declare">Declare</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-pc" onchange="filterMaterials()">
                            <label for="cert-pc">Product Circularity</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-ggtphd" onchange="filterMaterials()">
                            <label for="cert-ggtphd">GGTPHD</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-fsc" onchange="filterMaterials()">
                            <label for="cert-fsc">FSC/PEFC</label>
                        </div>
                        <div class="cert-checkbox">
                            <input type="checkbox" id="cert-ecolabel" onchange="filterMaterials()">
                            <label for="cert-ecolabel">ECOLABEL</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lista de materiais -->
            <div id="materialsList" class="materials-list">
                <!-- Materiais ser√£o carregados aqui via JavaScript -->
            </div>
        </div>

        <!-- P√°gina de gest√£o da base de dados -->
        <div id="database" class="page">
            <h1>Gest√£o da Base de Dados</h1>
            
            <div class="filter-row">
                <div class="filter-group">
                    <label for="dbSection">Selecionar Sec√ß√£o:</label>
                    <select id="dbSection" onchange="loadDbSection()">
                        <option value="materials">Materiais</option>
                        <option value="manufacturers">Fabricantes</option>
                        <option value="categories">Categorias</option>
                        <option value="subcategories">Subcategorias</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button class="btn btn-success" onclick="addNewItem()">‚ûï Adicionar Novo</button>
                </div>
            </div>

            <div id="dbContent">
                <!-- Conte√∫do da base de dados ser√° carregado aqui -->
            </div>
        </div>

        <!-- P√°gina de projetos -->
        <div id="projects" class="page">
            <h1>Gest√£o de Projetos</h1>
            
            <div class="filter-row">
                <div class="filter-group">
                    <button class="btn btn-success" onclick="createNewProject()">‚ûï Criar Novo Projeto</button>
                </div>
            </div>

            <div id="projectsList">
                <!-- Lista de projetos ser√° carregada aqui -->
            </div>
        </div>
    </div>

    <!-- Modal para detalhes/edi√ß√£o -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalContent">
                <!-- Conte√∫do do modal ser√° carregado aqui -->
            </div>
        </div>
    </div>

    <script>
        // Sistema de gest√£o de materiais - JavaScript principal
        
        // Dados simulados iniciais (normalmente viriam de uma base de dados)
        let materials = [
            {
                id: 1,
                name: "Madeira escura vaselinada",
                manufacturer: "Madeiras & madeira",
                category: "Madeiras",
                subcategory: "Madeiras tratadas",
                description: "Madeira tratada com verniz escuro resistente",
                evaluations: {
                    epd: { valid: true, issueDate: "2023-01-01", validTo: "2026-01-01", score: 94 },
                    lca: { valid: false, issueDate: "", validTo: "", score: 0 }
                }
            },
            {
                id: 2,
                name: "Cimento bruto viscoso",
                manufacturer: "Amorim Cimentos",
                category: "Cimentos",
                subcategory: "Cimentos especiais",
                description: "Cimento de alta resist√™ncia para constru√ß√£o",
                evaluations: {
                    epd: { valid: true, issueDate: "2022-01-01", validTo: "2025-01-01", score: 87 },
                    reach: { valid: true, issueDate: "2023-06-01", validTo: "2026-06-01", score: 92 }
                }
            }
        ];

        let manufacturers = ["Madeiras & madeira", "Amorim Cimentos", "FABRICANTE DE TESTE"];
        let categories = [
            { name: "Madeiras", subcategories: ["Madeiras tratadas", "Madeiras naturais"] },
            { name: "Cimentos", subcategories: ["Cimentos especiais", "Cimentos b√°sicos"] },
            { name: "Metais", subcategories: ["A√ßo", "Alum√≠nio"] }
        ];

        let projects = [];
        let currentProject = null;

        // Inicializa√ß√£o do sistema
        document.addEventListener('DOMContentLoaded', function() {
            loadInitialData();
            updateFilters();
            filterMaterials();
        });

        // Carregamento inicial de dados (simula dados da base de dados)
        function loadInitialData() {
            // Verificar se h√° dados salvos no localStorage
            const savedMaterials = localStorage.getItem('materials');
            if (savedMaterials) {
                materials = JSON.parse(savedMaterials);
            }

            const savedManufacturers = localStorage.getItem('manufacturers');
            if (savedManufacturers) {
                manufacturers = JSON.parse(savedManufacturers);
            }

            const savedCategories = localStorage.getItem('categories');
            if (savedCategories) {
                categories = JSON.parse(savedCategories);
            }

            const savedProjects = localStorage.getItem('projects');
            if (savedProjects) {
                projects = JSON.parse(savedProjects);
            }
        }

        // Salvar dados no localStorage
        function saveData() {
            localStorage.setItem('materials', JSON.stringify(materials));
            localStorage.setItem('manufacturers', JSON.stringify(manufacturers));
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('projects', JSON.stringify(projects));
        }

        // Navega√ß√£o entre p√°ginas
        function showPage(pageId) {
            // Remover classe active de todas as p√°ginas e itens de navega√ß√£o
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            // Ativar p√°gina e item de navega√ß√£o selecionados
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
            
            // Carregar conte√∫do espec√≠fico da p√°gina
            if (pageId === 'database') {
                loadDbSection();
            } else if (pageId === 'projects') {
                loadProjects();
            }
        }

        // Atualizar filtros com dados atuais
        function updateFilters() {
            // Atualizar filtro de fabricantes
            const manufacturerFilter = document.getElementById('manufacturerFilter');
            manufacturerFilter.innerHTML = '<option value="">Todos os fabricantes</option>';
            manufacturers.forEach(manufacturer => {
                manufacturerFilter.innerHTML += `<option value="${manufacturer}">${manufacturer}</option>`;
            });

            // Atualizar filtro de categorias
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="">Todas as categorias</option>';
            categories.forEach(category => {
                categoryFilter.innerHTML += `<option value="${category.name}">${category.name}</option>`;
            });
        }

        // Atualizar subcategorias baseado na categoria selecionada
        function updateSubcategories() {
            const categoryFilter = document.getElementById('categoryFilter');
            const subcategoryFilter = document.getElementById('subcategoryFilter');
            const selectedCategory = categoryFilter.value;
            
            subcategoryFilter.innerHTML = '<option value="">Todas as subcategorias</option>';
            
            if (selectedCategory) {
                const category = categories.find(cat => cat.name === selectedCategory);
                if (category && category.subcategories) {
                    category.subcategories.forEach(subcategory => {
                        subcategoryFilter.innerHTML += `<option value="${subcategory}">${subcategory}</option>`;
                    });
                }
            }
        }

        // Filtrar materiais baseado nos crit√©rios selecionados
        function filterMaterials() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            const manufacturerFilter = document.getElementById('manufacturerFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const subcategoryFilter = document.getElementById('subcategoryFilter').value;
            
            // Obter certifica√ß√µes selecionadas
            const selectedCerts = [];
            const certCheckboxes = document.querySelectorAll('.cert-checkbox input[type="checkbox"]:checked');
            certCheckboxes.forEach(checkbox => {
                selectedCerts.push(checkbox.id.replace('cert-', ''));
            });

            // Filtrar materiais
            const filteredMaterials = materials.filter(material => {
                // Filtro de texto (nome)
                const materialName = material.name.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                const matchesSearch = !searchTerm || materialName.includes(searchTerm);
                
                // Filtro de fabricante
                const matchesManufacturer = !manufacturerFilter || material.manufacturer === manufacturerFilter;
                
                // Filtro de categoria
                const matchesCategory = !categoryFilter || material.category === categoryFilter;
                
                // Filtro de subcategoria
                const matchesSubcategory = !subcategoryFilter || material.subcategory === subcategoryFilter;
                
                // Filtro de certifica√ß√µes
                const matchesCertifications = selectedCerts.length === 0 || selectedCerts.some(cert => 
                    material.evaluations && material.evaluations[cert] && material.evaluations[cert].valid
                );
                
                return matchesSearch && matchesManufacturer && matchesCategory && matchesSubcategory && matchesCertifications;
            });

            displayMaterials(filteredMaterials);
        }

        // Exibir lista de materiais
        function displayMaterials(materialsToShow) {
            const materialsList = document.getElementById('materialsList');
            
            if (materialsToShow.length === 0) {
                materialsList.innerHTML = '<div class="text-center" style="color: #B5B5B5; padding: 40px;">Nenhum material encontrado</div>';
                return;
            }
            
            materialsList.innerHTML = '';
            
            materialsToShow.forEach(material => {
                const materialCard = createMaterialCard(material);
                materialsList.appendChild(materialCard);
            });
        }

        // Criar card de material
        function createMaterialCard(material) {
            const card = document.createElement('div');
            card.className = 'material-card';
            card.onclick = () => showMaterialDetails(material.id);
            
            // Obter avalia√ß√µes v√°lidas
            const validEvaluations = [];
            if (material.evaluations) {
                Object.keys(material.evaluations).forEach(evalType => {
                    if (material.evaluations[evalType].valid) {
                        validEvaluations.push(evalType.toUpperCase());
                    }
                });
            }
            
            const evaluationsDisplay = validEvaluations.length > 0 ? validEvaluations.join('; ') : 'N/A';
            
            card.innerHTML = `
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="event.stopPropagation(); showMaterialDetails(${material.id})">Ver Detalhes</button>
                    <button class="btn btn-success" onclick="event.stopPropagation(); editMaterial(${material.id})">‚úèÔ∏è</button>
                    <button class="btn btn-danger" onclick="event.stopPropagation(); deleteMaterial(${material.id})">üóëÔ∏è</button>
                </div>
                <div class="material-name">${material.name}</div>
                <div class="material-details">
                    <div class="material-detail"><strong>Fabricante:</strong> ${material.manufacturer}</div>
                    <div class="material-detail"><strong>Categoria:</strong> ${material.category}</div>
                </div>
                <div class="material-detail"><strong>Descri√ß√£o:</strong> ${material.description || 'N/A'}</div>
                <div class="evaluations">
                    <span style="color: #35568C;"><strong>Avalia√ß√µes:</strong></span>
                    <span class="evaluation-tag eval-blue">${evaluationsDisplay}</span>
                </div>
            `;
            
            return card;
        }

        // Mostrar detalhes do material
        function showMaterialDetails(materialId) {
            const material = materials.find(m => m.id === materialId);
            if (!material) return;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <h2>${material.name}</h2>
                <div class="material-details">
                    <div class="material-detail"><strong>Fabricante:</strong> ${material.manufacturer}</div>
                    <div class="material-detail"><strong>Categoria:</strong> ${material.category}</div>
                    <div class="material-detail"><strong>Subcategoria:</strong> ${material.subcategory}</div>
                    <div class="material-detail"><strong>Descri√ß√£o:</strong> ${material.description || 'N/A'}</div>
                </div>
                
                <h3>Avalia√ß√µes e Certifica√ß√µes</h3>
                <div id="evaluationsDetail">
                    ${generateEvaluationsDetail(material.evaluations || {})}
                </div>
                
                <div class="mt-20">
                    <button class="btn btn-success" onclick="editMaterial(${material.id})">Editar Material</button>
                    <button class="btn btn-danger" onclick="deleteMaterial(${material.id})">Excluir Material</button>
                </div>
            `;
            
            document.getElementById('modal').style.display = 'block';
        }

        // Gerar detalhes das avalia√ß√µes
        function generateEvaluationsDetail(evaluations) {
            let html = '';
            
            const evalTypes = ['epd', 'lca', 'mi', 'reach', 'hpd', 'c2c', 'declare', 'pc', 'ggtphd', 'fsc', 'ecolabel'];
            const evalNames = {
                'epd': 'EPD',
                'lca': 'LCA',
                'mi': 'Manufacturer Inventory',
                'reach': 'REACH',
                'hpd': 'Health Product Declaration',
                'c2c': 'C2C',
                'declare': 'Declare',
                'pc': 'Product Circularity',
                'ggtphd': 'Global Green Tag PHD',
                'fsc': 'FSC/PEFC',
                'ecolabel': 'ECOLABEL'
            };
            
            evalTypes.forEach(evalType => {
                const evaluation = evaluations[evalType];
                if (evaluation && evaluation.valid) {
                    html += `
                        <div class="evaluation-section">
                            <div class="evaluation-header">
                                <div class="evaluation-title">${evalNames[evalType]}</div>
                                <div class="evaluation-score">${evaluation.score || 0}%</div>
                            </div>
                            <div class="material-details">
                                <div class="material-detail"><strong>Data de Emiss√£o:</strong> ${evaluation.issueDate || 'N/A'}</div>
                                <div class="material-detail"><strong>V√°lido at√©:</strong> ${evaluation.validTo || 'N/A'}</div>
                            </div>
                        </div>
                    `;
                }
            });
            
            return html || '<p>Nenhuma avalia√ß√£o dispon√≠vel</p>';
        }

        // Editar material
        function editMaterial(materialId) {
            const material = materials.find(m => m.id === materialId);
            if (!material) return;
            
            // Implementar formul√°rio de edi√ß√£o
            showMaterialForm(material);
        }

        // Excluir material
        function deleteMaterial(materialId) {
            if (confirm('Tem certeza de que deseja excluir este material?')) {
                materials = materials.filter(m => m.id !== materialId);
                saveData();
                filterMaterials();
                closeModal();
            }
        }

        // Mostrar formul√°rio de material (criar/editar)
        function showMaterialForm(material = null) {
            const isEdit = material !== null;
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <h2>${isEdit ? 'Editar' : 'Adicionar'} Material</h2>
                <form onsubmit="saveMaterial(event, ${isEdit ? material.id : 'null'})">
                    <div class="form-group">
                        <label for="materialName">Nome do Material:</label>
                        <input type="text" id="materialName" value="${isEdit ? material.name : ''}" required>
                    </div>
                    <div class="form-group">
                        <label for="materialManufacturer">Fabricante:</label>
                        <select id="materialManufacturer" required>
                            <option value="">Selecionar fabricante</option>
                            ${manufacturers.map(m => `<option value="${m}" ${isEdit && material.manufacturer === m ? 'selected' : ''}>${m}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="materialCategory">Categoria:</label>
                        <select id="materialCategory" onchange="updateMaterialSubcategories()" required>
                            <option value="">Selecionar categoria</option>
                            ${categories.map(c => `<option value="${c.name}" ${isEdit && material.category === c.name ? 'selected' : ''}>${c.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="materialSubcategory">Subcategoria:</label>
                        <select id="materialSubcategory" required>
                            <option value="">Selecionar subcategoria</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="materialDescription">Descri√ß√£o:</label>
                        <textarea id="materialDescription">${isEdit ? material.description || '' : ''}</textarea>
                    </div>
                    <div class="mt-20">
                        <button type="submit" class="btn btn-success">Salvar</button>
                        <button type="button" class="btn btn-danger" onclick="closeModal()">Cancelar</button>
                    </div>
                </form>
            `;
            
            if (isEdit) {
                setTimeout(() => updateMaterialSubcategories(material.subcategory), 100);
            }
            
            document.getElementById('modal').style.display = 'block';
        }

        // Atualizar subcategorias no formul√°rio de material
        function updateMaterialSubcategories(selectedSubcategory = '') {
            const categorySelect = document.getElementById('materialCategory');
            const subcategorySelect = document.getElementById('materialSubcategory');
            const selectedCategory = categorySelect.value;
            
            subcategorySelect.innerHTML = '<option value="">Selecionar subcategoria</option>';
            
            if (selectedCategory) {
                const category = categories.find(cat => cat.name === selectedCategory);
                if (category && category.subcategories) {
                    category.subcategories.forEach(subcategory => {
                        const selected = subcategory === selectedSubcategory ? 'selected' : '';
                        subcategorySelect.innerHTML += `<option value="${subcategory}" ${selected}>${subcategory}</option>`;
                    });
                }
            }
        }

        // Salvar material
        function saveMaterial(event, materialId) {
            event.preventDefault();
            
            const name = document.getElementById('materialName').value;
            const manufacturer = document.getElementById('materialManufacturer').value;
            const category = document.getElementById('materialCategory').value;
            const subcategory = document.getElementById('materialSubcategory').value;
            const description = document.getElementById('materialDescription').value;
            
            const materialData = {
                name,
                manufacturer,
                category,
                subcategory,
                description,
                evaluations: {}
            };
            
            if (materialId) {
                // Editar material existente
                const materialIndex = materials.findIndex(m => m.id === materialId);
                materials[materialIndex] = { ...materials[materialIndex], ...materialData };
            } else {
                // Adicionar novo material
                const newId = Math.max(...materials.map(m => m.id), 0) + 1;
                materials.push({ id: newId, ...materialData });
            }
            
            saveData();
            updateFilters();
            filterMaterials();
            closeModal();
        }

        // Gest√£o da base de dados
        function loadDbSection() {
            const section = document.getElementById('dbSection').value;
            const dbContent = document.getElementById('dbContent');
            
            switch (section) {
                case 'materials':
                    loadMaterialsManagement();
                    break;
                case 'manufacturers':
                    loadManufacturersManagement();
                    break;
                case 'categories':
                    loadCategoriesManagement();
                    break;
                case 'subcategories':
                    loadSubcategoriesManagement();
                    break;
            }
        }

        function loadMaterialsManagement() {
            const dbContent = document.getElementById('dbContent');
            dbContent.innerHTML = `
                <h3>Gest√£o de Materiais</h3>
                <div class="materials-list">
                    ${materials.map(material => `
                        <div class="material-card">
                            <div class="action-buttons">
                                <button class="btn btn-success" onclick="editMaterial(${material.id})">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger" onclick="deleteMaterial(${material.id})">üóëÔ∏è Excluir</button>
                            </div>
                            <div class="material-name">${material.name}</div>
                            <div class="material-details">
                                <div class="material-detail"><strong>Fabricante:</strong> ${material.manufacturer}</div>
                                <div class="material-detail"><strong>Categoria:</strong> ${material.category}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function loadManufacturersManagement() {
            const dbContent = document.getElementById('dbContent');
            dbContent.innerHTML = `
                <h3>Gest√£o de Fabricantes</h3>
                <div class="materials-list">
                    ${manufacturers.map((manufacturer, index) => `
                        <div class="material-card">
                            <div class="action-buttons">
                                <button class="btn btn-success" onclick="editManufacturer(${index})">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger" onclick="deleteManufacturer(${index})">üóëÔ∏è Excluir</button>
                            </div>
                            <div class="material-name">${manufacturer}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function loadCategoriesManagement() {
            const dbContent = document.getElementById('dbContent');
            dbContent.innerHTML = `
                <h3>Gest√£o de Categorias</h3>
                <div class="materials-list">
                    ${categories.map((category, index) => `
                        <div class="material-card">
                            <div class="action-buttons">
                                <button class="btn btn-success" onclick="editCategory(${index})">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger" onclick="deleteCategory(${index})">üóëÔ∏è Excluir</button>
                            </div>
                            <div class="material-name">${category.name}</div>
                            <div class="material-detail"><strong>Subcategorias:</strong> ${category.subcategories.join(', ')}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function loadSubcategoriesManagement() {
            const dbContent = document.getElementById('dbContent');
            let allSubcategories = [];
            categories.forEach(category => {
                category.subcategories.forEach(subcategory => {
                    allSubcategories.push({ name: subcategory, category: category.name });
                });
            });

            dbContent.innerHTML = `
                <h3>Gest√£o de Subcategorias</h3>
                <div class="materials-list">
                    ${allSubcategories.map((subcategory, index) => `
                        <div class="material-card">
                            <div class="action-buttons">
                                <button class="btn btn-danger" onclick="deleteSubcategory('${subcategory.category}', '${subcategory.name}')">üóëÔ∏è Excluir</button>
                            </div>
                            <div class="material-name">${subcategory.name}</div>
                            <div class="material-detail"><strong>Categoria:</strong> ${subcategory.category}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Adicionar novo item
        function addNewItem() {
            const section = document.getElementById('dbSection').value;
            
            switch (section) {
                case 'materials':
                    showMaterialForm();
                    break;
                case 'manufacturers':
                    addManufacturer();
                    break;
                case 'categories':
                    addCategory();
                    break;
                case 'subcategories':
                    addSubcategory();
                    break;
            }
        }

        // Fun√ß√µes para gest√£o de fabricantes
        function addManufacturer() {
            const name = prompt('Nome do fabricante:');
            if (name && !manufacturers.includes(name)) {
                manufacturers.push(name);
                manufacturers.sort();
                saveData();
                updateFilters();
                loadDbSection();
            }
        }

        function editManufacturer(index) {
            const newName = prompt('Novo nome do fabricante:', manufacturers[index]);
            if (newName && newName !== manufacturers[index]) {
                manufacturers[index] = newName;
                manufacturers.sort();
                saveData();
                updateFilters();
                loadDbSection();
            }
        }

        function deleteManufacturer(index) {
            if (confirm('Tem certeza de que deseja excluir este fabricante?')) {
                manufacturers.splice(index, 1);
                saveData();
                updateFilters();
                loadDbSection();
            }
        }

        // Fun√ß√µes para gest√£o de categorias
        function addCategory() {
            const name = prompt('Nome da categoria:');
            if (name && !categories.find(c => c.name === name)) {
                categories.push({ name, subcategories: [] });
                categories.sort((a, b) => a.name.localeCompare(b.name));
                saveData();
                updateFilters();
                loadDbSection();
            }
        }

        function editCategory(index) {
            const newName = prompt('Novo nome da categoria:', categories[index].name);
            if (newName && newName !== categories[index].name) {
                categories[index].name = newName;
                categories.sort((a, b) => a.name.localeCompare(b.name));
                saveData();
                updateFilters();
                loadDbSection();
            }
        }

        function deleteCategory(index) {
            if (confirm('Tem certeza de que deseja excluir esta categoria?')) {
                categories.splice(index, 1);
                saveData();
                updateFilters();
                loadDbSection();
            }
        }

        // Fun√ß√µes para gest√£o de subcategorias
        function addSubcategory() {
            const categoryName = prompt('Categoria (nome exato):');
            const category = categories.find(c => c.name === categoryName);
            if (!category) {
                alert('Categoria n√£o encontrada!');
                return;
            }
            
            const subcategoryName = prompt('Nome da subcategoria:');
            if (subcategoryName && !category.subcategories.includes(subcategoryName)) {
                category.subcategories.push(subcategoryName);
                category.subcategories.sort();
                saveData();
                updateFilters();
                loadDbSection();
            }
        }

        function deleteSubcategory(categoryName, subcategoryName) {
            if (confirm('Tem certeza de que deseja excluir esta subcategoria?')) {
                const category = categories.find(c => c.name === categoryName);
                if (category) {
                    category.subcategories = category.subcategories.filter(s => s !== subcategoryName);
                    saveData();
                    updateFilters();
                    loadDbSection();
                }
            }
        }

        // Gest√£o de projetos
        function loadProjects() {
            const projectsList = document.getElementById('projectsList');
            
            if (projects.length === 0) {
                projectsList.innerHTML = '<div class="text-center" style="color: #B5B5B5; padding: 40px;">Nenhum projeto criado</div>';
                return;
            }
            
            projectsList.innerHTML = projects.map(project => `
                <div class="material-card">
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="openProject(${project.id})">Abrir</button>
                        <button class="btn btn-success" onclick="editProject(${project.id})">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="deleteProject(${project.id})">üóëÔ∏è</button>
                    </div>
                    <div class="material-name">${project.name}</div>
                    <div class="material-details">
                        <div class="material-detail"><strong>Descri√ß√£o:</strong> ${project.description}</div>
                        <div class="material-detail"><strong>Per√≠odo:</strong> ${project.startDate} a ${project.endDate}</div>
                    </div>
                    <div class="material-detail"><strong>Materiais:</strong> ${project.materials ? project.materials.length : 0}</div>
                </div>
            `).join('');
        }

        function createNewProject() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <h2>Criar Novo Projeto</h2>
                <form onsubmit="saveProject(event)">
                    <div class="form-group">
                        <label for="projectName">Nome do Projeto:</label>
                        <input type="text" id="projectName" required>
                    </div>
                    <div class="form-group">
                        <label for="projectDescription">Descri√ß√£o:</label>
                        <textarea id="projectDescription"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="projectStartDate">Data de In√≠cio:</label>
                        <input type="date" id="projectStartDate" required>
                    </div>
                    <div class="form-group">
                        <label for="projectEndDate">Data de Fim:</label>
                        <input type="date" id="projectEndDate" required>
                    </div>
                    <div class="form-group">
                        <label for="projectExcel">Arquivo Excel:</label>
                        <input type="file" id="projectExcel" accept=".xlsx,.xls" onchange="handleExcelFile(event)">
                    </div>
                    <div class="mt-20">
                        <button type="submit" class="btn btn-success">Criar Projeto</button>
                        <button type="button" class="btn btn-danger" onclick="closeModal()">Cancelar</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal').style.display = 'block';
        }

        function saveProject(event) {
            event.preventDefault();
            
            const name = document.getElementById('projectName').value;
            const description = document.getElementById('projectDescription').value;
            const startDate = document.getElementById('projectStartDate').value;
            const endDate = document.getElementById('projectEndDate').value;
            
            const newProject = {
                id: Math.max(...projects.map(p => p.id), 0) + 1,
                name,
                description,
                startDate,
                endDate,
                materials: currentProject ? currentProject.materials : []
            };
            
            projects.push(newProject);
            saveData();
            loadProjects();
            closeModal();
            currentProject = null;
        }

        function handleExcelFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Simular leitura de arquivo Excel
            // Em uma implementa√ß√£o real, usaria uma biblioteca como SheetJS
            const reader = new FileReader();
            reader.onload = function(e) {
                // Dados simulados do Excel baseados no exemplo fornecido
                const excelData = [
                    { id: 'MQT001', name: 'addfsgdsd', manufacturer: 'Fab1', m2: 312, m3: '', units: '' },
                    { id: 'MQT002', name: 'Nome2', manufacturer: 'Fab2', m2: '', m3: 645, units: '' },
                    { id: 'MQT003', name: 'Nome3', manufacturer: 'Fab3', m2: '', m3: '', units: 34567 }
                ];
                
                currentProject = { materials: excelData };
                alert('Arquivo Excel carregado com sucesso!');
            };
            reader.readAsText(file);
        }

        function deleteProject(projectId) {
            if (confirm('Tem certeza de que deseja excluir este projeto?')) {
                projects = projects.filter(p => p.id !== projectId);
                saveData();
                loadProjects();
            }
        }

        // Fun√ß√£o para fechar modal
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Fechar modal clicando fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
